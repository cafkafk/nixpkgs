diff --git a/build.bash b/build.bash
index 502d554..aaaa806 100755
--- a/build.bash
+++ b/build.bash
@@ -28,14 +28,11 @@ case "$(uname)" in
     *) die $(uname) is not supported;;
 esac
 
-test -n "${1-}" || die "usage: $0 build-directory"
-
 outd=$1
 srcd=$(dirname $0)
 mudir=$outd/mupdf
-muinc="-I $mudir/include -I $mudir/thirdparty/freetype/include"
 
-test -d $mudir || die muPDF wasn\'t found in $outd/, consult $srcd/BUILDING
+# mudeps=('freetype2' 'gumbo' 'harfbuzz' 'libjpeg' 'libopenjp2' 'x11' 'zlib')
 
 mkdir -p $outd/{$wsid,lablGL}
 
@@ -44,9 +41,10 @@ isfresh() { test "$(<$1.past)" = "$2"; } 2>/dev/null
 mbt=${mbt:-release}
 test -n "${gmk:-}" && gmk=false || gmk=true
 
+mulibst="$mudir/build/$mbt/libs"
 mulibs="$mudir/build/$mbt/libmupdf.a $mudir/build/$mbt/libmupdf-third.a"
-make="make -C "$mudir" build=$mbt -j $mjobs libs"
-$make -q -s || $make
+# make="make -C "$mudir" build=$mbt -j $mjobs libs"
+# $make -q -s || $make
 
 oincs() {
     local b=$1 incs
@@ -70,6 +68,7 @@ oincs() {
     test -z "${incs-}" || echo $incs
 }
 
+
 oflags() {
     case "${1#$outd/}" in
         lablGL/*) f="-g";;
@@ -85,7 +84,8 @@ cflags() {
         version.o) f=-DLLPP_VERSION=$ver;;
         lablGL/*.o) f="-g -Wno-pointer-sign -Werror -O2";;
         link.o)
-            f="-g -std=c11 $muinc -Wall -Werror -Wextra -pedantic "
+	  f="-g -std=c11 --cflags -lfreetype -lgumbo -ljpeg -lopenjp2 -llcms2 -lharfbuzz -lz -Wall -Werror -Wextra -pedantic "
+	  f="-g -std=11 -Wall -Werror -Wextra -pedantic -lmupdf -lmupdf-third -lfreetype -lgumbo -ljpeg -lopenjp2 -ljbig2dec -llcms2 -lharfbuzz -lpthread -lz"
             test "${mbt-}" = "debug" || f+="-O2 "
             $darwin && f+="-DMACOS -D_GNU_SOURCE -DGL_H='<OpenGL/gl.h>'" \
                     || f+="-D_POSIX_C_SOURCE -DGL_H='<GL/gl.h>'"
@@ -104,39 +104,6 @@ mflags() {
 }
 
 overs=$(ocamlc -vnum 2>/dev/null) || overs=""
-if test "$overs" != "4.13.1"; then
-    url=https://caml.inria.fr/pub/distrib/ocaml-4.13/ocaml-4.13.1.tar.xz
-    txz=$outd/$(basename $url)
-    keycmd="printf $url; digest $txz;"
-    isfresh $txz "$(eval $keycmd)" || {
-        if executable_p wget; then dl() { wget "$1" -O "$2"; }
-        elif executable_p curl; then dl() { curl -L "$1" -o "$2"; }
-        else die "no program to fetch remote urls found"
-        fi
-        dl $url $txz
-        eval $keycmd >$txz.past
-    } && vecho "fresh $txz"
-    absprefix=$(realpath $outd)
-    export PATH=$absprefix/bin:$PATH
-    ocamlc=$absprefix/bin/ocamlc
-    keycmd="printf $url; digest $ocamlc;"
-    isfresh $ocamlc "$(eval $keycmd)" || (
-        # This will needlessly re{configure,make} ocaml since "past"
-        # of configure/make is hard to ascertain. "Better safe than
-        # sorry" approach is taken here. The check will work for a
-        # single ocaml url/version, but _will_ redo _everything_
-        # otherwise (even if fully built artifacts are available)
-        tar xf $txz -C $outd
-        bn=$(basename $url)
-        cd $outd/${bn%.tar.xz}
-        ./configure --disable-ocamldoc --disable-ocamltest      \
-                    --enable-debugger=no --prefix=$absprefix
-        make -j $mjobs world
-        make install
-        eval $keycmd >$absprefix/bin/ocamlc.past
-    ) && vecho "fresh ocamlc"
-    overs=$(ocamlc -vnum 2>/dev/null)
-fi
 
 while read k v; do
     case "$k" in
@@ -225,7 +192,7 @@ bobjc() {
     baux $o "$mcomp $(mflags $o) -MD -MF $o.dep -MT_ -c -o $o $srcd/${1%.o}.m"
 }
 
-ver=$(cd $srcd && git describe --tags --dirty) || ver="'built on $(date)'"
+ver=@version@
 
 gen=$srcd/genconfstruct.sh
 out=$outd/confstruct.ml
@@ -307,7 +274,7 @@ for m in ml_gl ml_glarray ml_raw; do
 done
 
 libs="str.cma unix.cma"
-clibs="-L$mudir/build/$mbt -lmupdf -lmupdf-third -lpthread"
+clibs="-lmupdf -lmupdf-third -lfreetype -lgumbo -ljpeg -lopenjp2 -ljbig2dec -llcms2 -lharfbuzz -lpthread -lz"
 if $darwin; then
     mcomp=$ccomp
     clibs+=" -framework Cocoa -framework OpenGL"
